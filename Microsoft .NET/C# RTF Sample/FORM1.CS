using System;
using System.Collections.Generic;
using System.IO;
using System.Text;
using System.Windows.Forms;
using combit.ListLabel24;
using MetroFramework.Forms;

namespace RTFSample
{
    public partial class Form1 : MetroForm
    {
        public Form1()
        {
            InitializeComponent();

            //
            // TODO: Add any constructor code after InitializeComponent call
            //
            if (!File.Exists("rtf.crd"))
            {
                Directory.SetCurrentDirectory(@"..\..\");
            }

            // Preload initial file
            LoadFileInRTFControl(Path.Combine(Directory.GetCurrentDirectory(), "infodlg.rtf"));
        }

        /// <summary>
        /// The main entry point for the application.
        /// </summary>
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.Run(new Form1());
        }

        private void LoadFileInRTFControl(string FileName)
        {
            // Set the contents
            listLabelRTFControl1.Content = File.ReadAllText(FileName, Encoding.ASCII);
        }

        /// <summary>
        /// Property to to get the rtf content. It's read only.
        /// </summary>
        private List<RtfContent> RtfDataSource
        {
            get
            {
                listLabelRTFControl1.ContentMode = LlRTFContentMode.Evaluated;
                List<RtfContent> result = new List<RtfContent>();
                result.Add(new RtfContent(this.listLabelRTFControl1.Content));
                return result;
            }
        }

        private void MenuItem5_Click(object sender, System.EventArgs e)
        {
            Close();
        }

        private void MetroButton1_Click(object sender, EventArgs e)
        {
            // Let user choose file and display
            if (ofd.ShowDialog() == DialogResult.OK)
            {
                LoadFileInRTFControl(ofd.FileName);
            }
        }

        private void MetroButton2_Click(object sender, EventArgs e)
        {
            try
            {
                // Call designer for project "rtf.crd"
                listLabel1.DataSource = RtfDataSource;
                listLabel1.Design("Define RTF Layout", LlProject.Card, "rtf.crd", true);
            }
            catch (ListLabelException LlException)
            {
                // Catch Exceptions
                MessageBox.Show("Information: " + LlException.Message + "\n\nThis information was generated by a List & Label custom exception.", "Information", MessageBoxButtons.OK, MessageBoxIcon.Information);
            }
        }

        private void MetroButton3_Click(object sender, EventArgs e)
        {
            try
            {
                // Print project "rtf.crd"
                listLabel1.DataSource = RtfDataSource;
                listLabel1.Print(LlProject.Card, "rtf.crd", false, LlPrintMode.Export, LlBoxType.StandardWait, "Printing...", true, "");
            }
            catch (ListLabelException LlException)
            {
                // Catch Exceptions
                MessageBox.Show("Information: " + LlException.Message + "\n\nThis information was generated by a List & Label custom exception.", "Information", MessageBoxButtons.OK, MessageBoxIcon.Information);
            }
        }
    }


    // helper class for holding the rtf content
    class RtfContent
    {
        public RtfContent(string content)
        {
            Content = content;
        }

        public string Content { get; set; }
    }
}
